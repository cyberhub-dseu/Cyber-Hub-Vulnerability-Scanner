import subprocess
import sys

def install_dependencies():
    """
    Install dependencies from the 'requirements.txt' file.
    If the installation fails, it provides an error message and exits the script.
    """
    try:
        print("Installing dependencies from requirements.txt...")
        # Run pip to install the dependencies listed in requirements.txt
        subprocess.check_call([sys.executable, '-m', 'pip', 'install', '-r', 'requirements.txt'])
        print("Dependencies installed successfully.")
    except subprocess.CalledProcessError as e:
        # If pip fails, catch the error and display an appropriate message
        print(f"Error: Failed to install dependencies. Error details: {e}")
        sys.exit(1)
    except Exception as e:
        # Catch any other unexpected exceptions
        print(f"An unexpected error occurred: {e}")
        sys.exit(1)

def check_python_version():
    """
    Check if the Python version is 3.8 or higher.
    If not, it exits the script with a message.
    """
    if sys.version_info < (3, 8):
        print("Error: CyberHubVulnerabilityScanner requires Python 3.8 or higher. Please upgrade your Python version.")
        sys.exit(1)

def check_nmap_installed():
    """
    Check if Nmap is installed on the system.
    If not installed, display installation instructions and exit.
    """
    try:
        # Try running the Nmap version check
        subprocess.run(['nmap', '--version'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        print("Nmap is installed.")
    except FileNotFoundError:
        print("Error: Nmap is not installed. Please install Nmap before using this tool.")
        print("Instructions:")
        if sys.platform.startswith('linux'):
            print("For Linux: sudo apt install nmap")
        elif sys.platform == 'darwin':
            print("For macOS: brew install nmap")
        elif sys.platform == 'win32':
            print("For Windows: Download and install from https://nmap.org/download.html")
        sys.exit(1)

if __name__ == "__main__":
    print("Starting installation process for Cyber Hub Vulnerability Scanner...")
    
    # Check if Python version is 3.8 or higher
    check_python_version()

    # Check if Nmap is installed
    check_nmap_installed()

    # Install dependencies
    install_dependencies()

    print("Installation complete! You can now use Cyber Hub Vulnerability Scanner.")
