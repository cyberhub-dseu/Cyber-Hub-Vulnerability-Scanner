import subprocess
import sys
from setuptools import setup, find_packages

# Check Python version
if sys.version_info < (3, 8):
    sys.exit("Error: CyberHubVulnerabilityScanner requires Python 3.8 or higher. Please upgrade your Python version.")

# Check if Nmap is installed
def check_nmap():
    try:
        subprocess.run(['nmap', '--version'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    except FileNotFoundError:
        print("Error: Nmap is not installed. Please install Nmap and try again.")
        sys.exit(1)

# Install dependencies from requirements.txt
def install_dependencies():
    try:
        subprocess.check_call([sys.executable, '-m', 'pip', 'install', '-r', 'requirements.txt'])
    except subprocess.CalledProcessError:
        print("Error: Failed to install dependencies. Please check the error messages.")
        sys.exit(1)

# Run checks before installation
check_nmap()
install_dependencies()

# Setup function to install the package
setup(
    name='CyberHubVulnerabilityScanner',
    version='1.0',
    packages=find_packages(),
    install_requires=[
        'python-nmap',
        'requests',
        'beautifulsoup4',
        'sqlalchemy',
        'flask',
        'pyfiglet'
    ],
    entry_points={
        'console_scripts': [
            'chvs = chvs.core:main',
        ]
    },
)
